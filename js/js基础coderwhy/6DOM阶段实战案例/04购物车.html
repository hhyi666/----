<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        table {
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #aaa;
            padding: 8px 12px;
        }

        thead {
            background-color: #f5f5f5;
        }
    </style>
</head>

<body>
    <table>
        <thead>
            <tr>
                <th>编号</th>
                <th>书籍名称</th>
                <th>出版日期</th>
                <th>价格</th>
                <th>数量</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <h2 class = "price">
        总价格：￥<span class = "price-out">0</span></h2>
    <script>
        var books = [
            {
                id: 1,
                name: `《算法导论》`,
                data : 2003,
                price: 85.00,
                count: 3,
            },
            {
                id: 2,
                name: `UNIX编成艺术`,
                data : 2444,
                price: 59.00,
                count: 2
            },
            {
                id: 3,
                name: `《编程珠玑》`,
                data : 2222,
                price: 39.00,
                count: 5
            },
        ]

        var tbodyEl = document.querySelector("tbody")
        for (var i = 0; i < books.length; i++) {
            var trEl = document.createElement("tr")
            var book = books[i]
            var bookKeys = Object.keys(book)
            //拿对象的数据
            for(var m = 0;m<bookKeys.length;m++){
                var key = bookKeys[m]
                var value = book[key]
                var tdEl = document.createElement("td")
                //把td创建加入tr
                tdEl.textContent = value
                trEl.append(tdEl)
            }
            var deleteEl = document.createElement("td")
            var deleteBtnEl = document.createElement("button")
            deleteEl.append(deleteBtnEl)
            //按钮记得加入td当中
            deleteBtnEl.textContent = "删除"
            trEl.append(deleteEl)

            deleteBtnEl.onclick = function(){
                //删除对应的tr
                var deleteBtnElRowEl = this.parentElement.parentElement
                // console.log(deleteBtnElRowEl)
                var deletetrIndex = deleteBtnElRowEl.sectionRowIndex
                //给定封闭的tr的索引
                deleteBtnElRowEl.remove()

                //删除books的数据
                books.splice(deletetrIndex,1)

                //再次调用重新计算价格
                calc()

            }

            tbodyEl.append(trEl)
        }

        //计算总价格
        var pricesum = document.querySelector(".price-out")
        // var sum = 0
        // for(var i = 0;i<books.length;i++){
        //     sum += books[i].count*books[i].price
        // }

        //计算价格
        calc()


        //封装计算价格的函数便于调用
        function calc(){
            var sum = books.reduce(function(preValue,item){
                return preValue+item.count*item.price
            },0)
            pricesum.textContent = sum
        }

    </script>
</body>

</html>